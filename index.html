<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Feel Strings</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="theme-color" content="#111111" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="manifest" href="manifest.webmanifest" />

    <style>
        :root {
            --bg: #050608;
            --bg-soft: #111320;
            --accent: #ffb347;
            --accent-soft: rgba(255, 179, 71, 0.12);
            --text: #f5f5f7;
            --muted: #9ea2b5;
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background: radial-gradient(circle at top, #1f2233 0, #050608 55%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        .app {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 16px 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        header h1 {
            font-size: 1.25rem;
            margin: 0;
            letter-spacing: 0.03em;
        }

        header small {
            font-size: 0.75rem;
            color: var(--muted);
        }

        .pill {
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.04);
            font-size: 0.7rem;
            color: var(--muted);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .emotions {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .emotion-btn {
            border: none;
            outline: none;
            border-radius: var(--radius);
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.03);
            color: var(--text);
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.09s ease, background 0.12s ease, box-shadow 0.12s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            -webkit-tap-highlight-color: transparent;
        }

        .emotion-btn span.emoji {
            font-size: 1.4rem;
        }

        .emotion-btn span.label {
            opacity: 0.9;
        }

        .emotion-btn.active {
            background: linear-gradient(135deg, var(--accent-soft), rgba(255, 255, 255, 0.05));
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.5);
            transform: translateY(-1px) scale(1.02);
        }

        .emotion-btn:active {
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
        }

        .panel {
            background: rgba(5, 6, 12, 0.9);
            border-radius: 20px;
            padding: 14px 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .panel-header-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .panel-title {
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .panel-current {
            font-size: 1rem;
            font-weight: 600;
        }

        .panel-sub {
            font-size: 0.75rem;
            color: var(--muted);
        }

        .progression {
            margin-top: 4px;
            padding: 10px 10px 8px;
            border-radius: 14px;
            background: radial-gradient(circle at top left, rgba(255, 179, 71, 0.12), rgba(255, 255, 255, 0.02));
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 40px;
        }

        .chord-pill {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            font-size: 0.85rem;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(6px);
        }

        button.round {
            border-radius: 999px;
            border: none;
            padding: 8px 14px;
            font-size: 0.8rem;
            background: var(--accent);
            color: #201b0d;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
            -webkit-tap-highlight-color: transparent;
        }

        button.round:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.85);
        }

        .hint {
            font-size: 0.7rem;
            color: var(--muted);
            margin-top: 2px;
        }

        .play-meta {
            margin-top: 8px;
            padding-top: 6px;
            border-top: 1px dashed rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.75rem;
        }

        .meta-row {
            display: flex;
            gap: 6px;
            align-items: baseline;
        }

        .meta-label {
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-size: 0.68rem;
            color: var(--muted);
            min-width: 70px;
        }

        .meta-value {
            flex: 1;
            color: var(--text);
        }

        .meta-small {
            font-size: 0.7rem;
            color: var(--muted);
        }
    </style>
</head>

<body>
    <div class="app">
        <header>
            <div>
                <h1>Feel Strings üé∏</h1>
                <small>Tap a feeling ‚Üí random progression</small>
            </div>
            <div class="pill">Advanced ¬∑ v2</div>
        </header>

        <section>
            <div class="emotions" id="emotions">
                <button class="emotion-btn" data-emotion="happy">
                    <span class="emoji">üòä</span>
                    <span class="label">Happy</span>
                </button>
                <button class="emotion-btn" data-emotion="sad">
                    <span class="emoji">üò¢</span>
                    <span class="label">Sad</span>
                </button>
                <button class="emotion-btn" data-emotion="inspired">
                    <span class="emoji">‚ú®</span>
                    <span class="label">Inspired</span>
                </button>
                <button class="emotion-btn" data-emotion="anger">
                    <span class="emoji">üò°</span>
                    <span class="label">Anger</span>
                </button>
                <button class="emotion-btn" data-emotion="ashamed">
                    <span class="emoji">üôà</span>
                    <span class="label">Ashamed</span>
                </button>
                <button class="emotion-btn" data-emotion="loved">
                    <span class="emoji">‚ù§Ô∏è</span>
                    <span class="label">Loved</span>
                </button>
            </div>
        </section>

        <section class="panel">
            <div class="panel-header">
                <div class="panel-header-left">
                    <span class="panel-title">Current progression</span>
                    <span class="panel-current" id="currentEmotion">‚Äî</span>
                    <span class="panel-sub" id="currentSub">Tap a mood to get 1 of 10 variations</span>
                </div>
                <button class="round" id="replayBtn" disabled>
                    ‚ñ∂Ô∏é Replay
                </button>
            </div>

            <div class="progression" id="progression"></div>

            <div class="play-meta">
                <div class="meta-row">
                    <span class="meta-label">Name</span>
                    <span class="meta-value" id="metaName">‚Äî</span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Strum</span>
                    <span class="meta-value" id="metaPattern">‚Äî</span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Style</span>
                    <span class="meta-value" id="metaTechnique">‚Äî</span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Info</span>
                    <span class="meta-value meta-small" id="metaExtra">‚Äî</span>
                </div>
            </div>

            <div class="hint">
                Best with headphones ¬∑ triangle synth, use this as a practice companion.
            </div>
        </section>
    </div>

    <script>
        // ---------- Note frequencies ----------
        const noteFreq = {
            C3: 130.81, D3: 146.83, E3: 164.81, F3: 174.61, G3: 196.00, A3: 220.00, B3: 246.94,
            C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23, G4: 392.00, A4: 440.00, B4: 493.88
        };

        // ---------- Chord voicings (simple, open-ish) ----------
        const chords = {
            // C family
            C: ["C4", "E4", "G4"],
            Csus2: ["C4", "D4", "G4"],
            Csus4: ["C4", "F4", "G4"],
            Cmaj7: ["C4", "E4", "B4"],
            Cadd9: ["C4", "E4", "D4"],
            // G family
            G: ["G3", "B3", "D4"],
            Gsus4: ["G3", "C4", "D4"],
            G7: ["G3", "B3", "D4", "F4"],
            Gadd9: ["G3", "A3", "D4"],
            // A family
            Am: ["A3", "C4", "E4"],
            Am7: ["A3", "C4", "E4", "G4"],
            A: ["A3", "C#4", "E4"], // approximate, uses C4 but it's OK for prototype
            A7: ["A3", "C4", "E4", "G4"],
            // F family
            F: ["F3", "A3", "C4"],
            Fmaj7: ["F3", "A3", "C4", "E4"],
            Fsus2: ["F3", "G3", "C4"],
            // D family
            Dm: ["D3", "F3", "A3"],
            Dm7: ["D3", "F3", "A3", "C4"],
            D: ["D3", "F#3", "A3"], // approx
            D7: ["D3", "F3", "A3", "C4"],
            // E family
            Em: ["E3", "G3", "B3"],
            Em7: ["E3", "G3", "B3", "D4"],
            E: ["E3", "G#3", "B3"], // approx
            E7: ["E3", "G3", "B3", "D4"],
            // small extras
            Bdim: ["B3", "D4", "F4"],
            Bb: ["Bb3", "D4", "F4"], // may be silent if Bb3 missing but fine for prototype
            Bbmaj7: ["Bb3", "D4", "F4", "A4"],
            E5: ["E3", "B3", "E4"],
            A5: ["A3", "E4", "A4"],
            G5: ["G3", "D4", "G4"]
        };

        // ---------- Emotions & 10 progressions each ----------
        // strum pattern legend examples: D = down, U = up, x = muted, H = hammer-on, P = pull-off
        const emotions = {
            happy: {
                label: "Happy",
                emoji: "üòä",
                description: "Bright, open pop progressions in C / G.",
                progressions: [
                    {
                        name: "Pop Classic I‚ÄìV‚Äìvi‚ÄìIV",
                        chords: ["C", "G", "Am", "F"],
                        pattern: "D  D  U U D U",
                        technique: "Loose wrist, light accent on 2 & 4.",
                        extra: "Think pop / worship vibe, let chords ring."
                    },
                    {
                        name: "Sunrise Maj7",
                        chords: ["Cmaj7", "G", "Am7", "Fmaj7"],
                        pattern: "D  (D U) (D U) U",
                        technique: "Soft dynamic, focus on clarity.",
                        extra: "Brush the top 3‚Äì4 strings, very gentle."
                    },
                    {
                        name: "Happy Shuffle",
                        chords: ["C", "F", "G", "C"],
                        pattern: "D  D U  D U",
                        technique: "Shuffle feel: long-short, long-short.",
                        extra: "Tap your foot, accent the first D of each beat."
                    },
                    {
                        name: "Add9 Smile",
                        chords: ["Cadd9", "G", "Am7", "Fmaj7"],
                        pattern: "D  xU  D U D U",
                        technique: "Palm mute on x, release for U.",
                        extra: "Light palm mute near bridge, more open on choruses."
                    },
                    {
                        name: "Csus Lift",
                        chords: ["Csus2", "C", "Cmaj7", "Fmaj7"],
                        pattern: "D D U U D U",
                        technique: "Play small arpeggio on last U.",
                        extra: "Move from sus2 ‚Üí C ‚Üí maj7 smoothly, no full stop."
                    },
                    {
                        name: "G Pop Drive",
                        chords: ["G", "D", "Em", "C"],
                        pattern: "D D U  U D U",
                        technique: "Strum from low to high on strong beats.",
                        extra: "Build energy by increasing volume each bar."
                    },
                    {
                        name: "Happy Folk",
                        chords: ["C", "F", "C", "G"],
                        pattern: "D U D U D U",
                        technique: "Even 8th-note feel, relaxed.",
                        extra: "Alternate bass: hit root note slightly stronger."
                    },
                    {
                        name: "Open Sky",
                        chords: ["G", "Em", "C", "D"],
                        pattern: "D  D U  U D",
                        technique: "Accents on the first D of each bar.",
                        extra: "Let D ring longer to feel the resolution."
                    },
                    {
                        name: "Sus Celebration",
                        chords: ["G", "Gsus4", "G", "C"],
                        pattern: "D H D U  D U",
                        technique: "Hammer-on from sus4 to major (H on 2nd beat).",
                        extra: "Really hear the tension‚Äìrelease Gsus4 ‚Üí G."
                    },
                    {
                        name: "Bright Cadence",
                        chords: ["F", "G", "C", "Cmaj7"],
                        pattern: "D  (D U)  U D",
                        technique: "Roll the wrist, small dynamics swell.",
                        extra: "Final Cmaj7: arpeggiate slowly instead of full strum."
                    }
                ]
            },

            sad: {
                label: "Sad",
                emoji: "üò¢",
                description: "Minor progressions, soft dynamics.",
                progressions: [
                    {
                        name: "vi‚ÄìIV‚ÄìI‚ÄìV Ballad",
                        chords: ["Am", "F", "C", "G"],
                        pattern: "D   D U   U D U",
                        technique: "Soft, close to the strings.",
                        extra: "Let the bass note ring slightly longer than the rest."
                    },
                    {
                        name: "Minor Arpeggio",
                        chords: ["Am7", "Fmaj7", "C", "G"],
                        pattern: "D (arpeggio): D U D U",
                        technique: "Arpeggiate: thumb on bass, index/middle on upper strings.",
                        extra: "Arpeggio especially on Am7 and Fmaj7 for color."
                    },
                    {
                        name: "Falling Line",
                        chords: ["C", "G/B", "Am", "Em"], // G/B conceptual only
                        pattern: "D  D U   U D U",
                        technique: "Gentle, with one accent per bar on the first D.",
                        extra: "Imagine bass line falling C ‚Üí B ‚Üí A ‚Üí E."
                    },
                    {
                        name: "Suspended Tears",
                        chords: ["Csus2", "Csus4", "C", "Am7"],
                        pattern: "D H D U  D U",
                        technique: "Hammer-on inside C shapes on higher strings.",
                        extra: "Use H on 3rd beat to move from sus to main chord."
                    },
                    {
                        name: "Minor Walk",
                        chords: ["Am", "G", "F", "Em"],
                        pattern: "D  xU  D U D U",
                        technique: "x = muted hit with left-hand lift.",
                        extra: "Mute on x by lightly releasing fretting pressure."
                    },
                    {
                        name: "Dm7 Lullaby",
                        chords: ["Dm7", "G", "C", "Cmaj7"],
                        pattern: "D  D U  U D",
                        technique: "Very quiet, play more with fingertips than nail.",
                        extra: "Let Cmaj7 ring to end the phrase, no strum on last beat."
                    },
                    {
                        name: "Reverse Resolution",
                        chords: ["Em", "Cmaj7", "G", "D"],
                        pattern: "D  D U   (rest) U",
                        technique: "Leave small gaps after strong beats.",
                        extra: "Tiny pauses increase the ‚Äúsighing‚Äù feeling."
                    },
                    {
                        name: "Broken Heart",
                        chords: ["Am", "Em", "F", "Dm"],
                        pattern: "D U D   U D U",
                        technique: "Slight crescendo on each bar.",
                        extra: "Lean more into the F and Dm chords emotionally."
                    },
                    {
                        name: "Descending Maj7",
                        chords: ["Cmaj7", "Bm7b5", "Am7", "G"],
                        pattern: "D  (D U)  U U",
                        technique: "Smooth arpeggio-like strums.",
                        extra: "Target the top 3 strings on maj7 for clarity."
                    },
                    {
                        name: "Soft Echo",
                        chords: ["Em7", "Cadd9", "G", "D"],
                        pattern: "D   D (U)   D U",
                        technique: "Ghost the (U): almost silent.",
                        extra: "Play (U) as a ghost stroke to keep your hand moving."
                    }
                ]
            },

            inspired: {
                label: "Inspired",
                emoji: "‚ú®",
                description: "Maj7, add9 and open chords for an uplifting feel.",
                progressions: [
                    {
                        name: "I‚ÄìIV‚ÄìV‚ÄìI Anthem",
                        chords: ["C", "F", "G", "C"],
                        pattern: "D D U  U D U",
                        technique: "Wide, confident strums.",
                        extra: "Let the last C ring; think ‚Äúanthem‚Äù chorus."
                    },
                    {
                        name: "Maj7 Dream",
                        chords: ["Cmaj7", "Fmaj7", "G", "Cmaj7"],
                        pattern: "D  (D U)  (D U)",
                        technique: "Arpeggiated D, then light strokes.",
                        extra: "Use slow D on beat 1, then gentle waves."
                    },
                    {
                        name: "Add9 Spark",
                        chords: ["Cadd9", "G", "Am7", "Dsus4"],
                        pattern: "D H U  D U",
                        technique: "Hammer-on (H) in the sus chord.",
                        extra: "Release Dsus4 ‚Üí D on last U for brightness."
                    },
                    {
                        name: "Ascending Light",
                        chords: ["Am7", "C", "Fmaj7", "G"],
                        pattern: "D  D U  U U",
                        technique: "Crescendo through the bar.",
                        extra: "Play G slightly louder to lift into next phrase."
                    },
                    {
                        name: "Epic Build",
                        chords: ["Em", "C", "G", "D"],
                        pattern: "D D U D U D",
                        technique: "Steady driving 8ths.",
                        extra: "Keep right hand moving constant, like a motor."
                    },
                    {
                        name: "Suspended Hope",
                        chords: ["G", "Gsus4", "G", "Cadd9"],
                        pattern: "D H D U D U",
                        technique: "H on sus4 then snap into G.",
                        extra: "Let Cadd9 be more delicate to reset the phrase."
                    },
                    {
                        name: "Open Road",
                        chords: ["D", "G", "A", "D"],
                        pattern: "D D U U D U",
                        technique: "Strums from low to high then high to low.",
                        extra: "Think ‚Äúroad trip‚Äù groove, medium tempo."
                    },
                    {
                        name: "Lift Off",
                        chords: ["Em7", "Cmaj7", "G", "D"],
                        pattern: "D  U D U  D U",
                        technique: "Alternate emphasis high / low strings.",
                        extra: "Emphasise treble on Em7 & Cmaj7, bass on G & D."
                    },
                    {
                        name: "Bright Pulse",
                        chords: ["C", "G", "Am", "Fmaj7"],
                        pattern: "D   D U  xU D",
                        technique: "Muted x before last D.",
                        extra: "x = small percussive hit with left-hand lift."
                    },
                    {
                        name: "Sparkle Arp",
                        chords: ["Cmaj7", "G", "Am7", "F"],
                        pattern: "D (arp) D (arp)",
                        technique: "Play D as broken chord (bass ‚Üí middle ‚Üí high).",
                        extra: "Use a bit more nail on top notes to make them sparkle."
                    }
                ]
            },

            anger: {
                label: "Anger",
                emoji: "üò°",
                description: "Power-chord-like shapes, muted hits, tense moves.",
                progressions: [
                    {
                        name: "Em Drive",
                        chords: ["Em", "F", "G", "F"],
                        pattern: "D xD xD xD",
                        technique: "Heavy downstrokes, strong palm mute.",
                        extra: "xD = muted downstroke, keep right hand tight near bridge."
                    },
                    {
                        name: "Power Push",
                        chords: ["E5", "G5", "A5", "G5"],
                        pattern: "D D D  xD",
                        technique: "All down, aggressive.",
                        extra: "Accentuate the first D of each chord change."
                    },
                    {
                        name: "Broken Rage",
                        chords: ["Em", "G", "Bdim", "Em"],
                        pattern: "D xU D xU",
                        technique: "Mute every x with left-hand lift.",
                        extra: "Bdim is short, almost like a stab."
                    },
                    {
                        name: "Stomp",
                        chords: ["Am", "G", "F", "E"],
                        pattern: "D D xD xD",
                        technique: "Alternate loud / muted hits.",
                        extra: "Tap foot hard on first D to externalise tension."
                    },
                    {
                        name: "Suspense",
                        chords: ["Em", "Gsus4", "G", "F"],
                        pattern: "D H D xD",
                        technique: "Hammer-on Gsus4 ‚Üí G, then heavy F.",
                        extra: "Let F ring slightly longer; it feels unresolved."
                    },
                    {
                        name: "Grinding",
                        chords: ["E5", "E5", "G5", "A5"],
                        pattern: "D D D D",
                        technique: "Continuous strong downstrokes.",
                        extra: "No dynamics, machine-like feel."
                    },
                    {
                        name: "Release",
                        chords: ["Em7", "D", "C", "Bdim"],
                        pattern: "D xU D xU",
                        technique: "Muted off-beats, sharp attacks.",
                        extra: "Short Bdim, then back to Em7 when looping."
                    },
                    {
                        name: "Pulse Attack",
                        chords: ["Em", "Em", "G", "G"],
                        pattern: "D xD D xD",
                        technique: "Palm mutes on x, full strum on non-x.",
                        extra: "Try accenting only beats 1 and 3."
                    },
                    {
                        name: "Sharp Cuts",
                        chords: ["Am", "F", "G", "E7"],
                        pattern: "D (choke) D (choke)",
                        technique: "Choke = instant mute after D.",
                        extra: "Choke by resting right hand across strings."
                    },
                    {
                        name: "Raw March",
                        chords: ["Em", "D", "C", "D"],
                        pattern: "D D D D",
                        technique: "Rigid, almost percussive.",
                        extra: "No swing; strict, stiff rhythm for intensity."
                    }
                ]
            },

            ashamed: {
                label: "Ashamed",
                emoji: "üôà",
                description: "Tension‚Äìresolution, dim and minor7 colours.",
                progressions: [
                    {
                        name: "ii‚ÄìV‚ÄìI‚Äìvi",
                        chords: ["Dm7", "G7", "Cmaj7", "Am7"],
                        pattern: "D  (D U)  U D",
                        technique: "Quiet, introspective dynamics.",
                        extra: "Lean into Dm7 and G7 as ‚Äúquestion‚Äù, Cmaj7 as ‚Äúanswer‚Äù."
                    },
                    {
                        name: "Hesitation",
                        chords: ["Csus2", "C", "Am7", "Fmaj7"],
                        pattern: "D H D U  U",
                        technique: "Hammer-on inside Csus2 ‚Üí C.",
                        extra: "Let Fmaj7 ring longer, almost like a sigh."
                    },
                    {
                        name: "Dim Step",
                        chords: ["C", "Bdim", "Am", "G"],
                        pattern: "D  (rest) D U",
                        technique: "Short Bdim with small accent.",
                        extra: "Bdim is the awkward step before falling to Am."
                    },
                    {
                        name: "Hidden Guilt",
                        chords: ["Em", "Cmaj7", "D", "G"],
                        pattern: "D U D   (x) U",
                        technique: "Ghost stroke on (x).",
                        extra: "Ghost stroke keeps hand moving but almost inaudible."
                    },
                    {
                        name: "Whispered",
                        chords: ["Am", "Fmaj7", "Dm7", "G"],
                        pattern: "D (arp)  U U",
                        technique: "Arpeggio Am and Fmaj7 softly.",
                        extra: "Play Dm7 and G slightly louder than the rest."
                    },
                    {
                        name: "Downcast",
                        chords: ["Am7", "C", "G", "F"],
                        pattern: "D D U  U D",
                        technique: "Let high strings be softer than bass.",
                        extra: "Keep tempo slow, don‚Äôt rush the changes."
                    },
                    {
                        name: "Avoidance",
                        chords: ["C", "F", "G7", "Cmaj7"],
                        pattern: "D   D U  xU D",
                        technique: "Muted x before resolving.",
                        extra: "G7 holds the tension; Cmaj7 softens the landing."
                    },
                    {
                        name: "Shy Steps",
                        chords: ["Dm", "Em", "F", "G"],
                        pattern: "D (short) D (short)",
                        technique: "Short, hesitant strokes.",
                        extra: "Make each bar slightly quieter than the previous."
                    },
                    {
                        name: "Maj7 Confession",
                        chords: ["Cmaj7", "Am7", "Fmaj7", "G"],
                        pattern: "D U D   U U",
                        technique: "Emphasise inner voices over bass.",
                        extra: "Imagine the lines between chords instead of the chords themselves."
                    },
                    {
                        name: "Soft Fall",
                        chords: ["Em7", "Dm7", "Cmaj7", "Am7"],
                        pattern: "D  D U  U",
                        technique: "Slow, rounded motion.",
                        extra: "Let each chord ring almost into the next one."
                    }
                ]
            },

            loved: {
                label: "Loved",
                emoji: "‚ù§Ô∏è",
                description: "Warm, gentle, lots of maj7 and 7th chords.",
                progressions: [
                    {
                        name: "I‚Äìvi‚ÄìIV‚ÄìV",
                        chords: ["C", "Am", "F", "G"],
                        pattern: "D D U  U D U",
                        technique: "Soft, regular heartbeat feel.",
                        extra: "Accent beats 2 and 4 slightly for a sway."
                    },
                    {
                        name: "Warm Maj7",
                        chords: ["Cmaj7", "Am7", "Fmaj7", "G"],
                        pattern: "D (arp) D U",
                        technique: "Slow arpeggio on every first D.",
                        extra: "Let maj7 chords ring, minimal palm mute."
                    },
                    {
                        name: "Romantic",
                        chords: ["C", "G/B", "Am7", "Fmaj7"],
                        pattern: "D  D U  U",
                        technique: "Gentle fingerstyle-like strums.",
                        extra: "Imagine a slow dance tempo, around 70‚Äì80 bpm."
                    },
                    {
                        name: "Heartbeat",
                        chords: ["Am7", "F", "C", "G"],
                        pattern: "D   (xD)   D U",
                        technique: "xD as small heartbeat mute.",
                        extra: "xD = very short muted hit between chords."
                    },
                    {
                        name: "Soft Swing",
                        chords: ["Cadd9", "G", "Em7", "D"],
                        pattern: "D D U  U D",
                        technique: "Swing the 8ths (long-short).",
                        extra: "Emphasise the ‚Äúup‚Äù into each change."
                    },
                    {
                        name: "Sus Hug",
                        chords: ["G", "Dsus4", "D", "Cadd9"],
                        pattern: "D H D U D",
                        technique: "Hammer-on Dsus4 ‚Üí D on beat 2.",
                        extra: "Make Cadd9 the softest strum of the cycle."
                    },
                    {
                        name: "Tender Walk",
                        chords: ["Fmaj7", "G", "Em7", "Am7"],
                        pattern: "D  D U   U U",
                        technique: "Smooth progression, no brutal accents.",
                        extra: "Fmaj7 to G is the ‚Äústep closer‚Äù moment."
                    },
                    {
                        name: "Evening Light",
                        chords: ["Dm7", "G7", "Cmaj7", "Cmaj7"],
                        pattern: "D U D   U",
                        technique: "Very slow, let notes breathe.",
                        extra: "On last Cmaj7, play an arpeggio instead of full strum."
                    },
                    {
                        name: "Open Arms",
                        chords: ["C", "F", "G", "Am7"],
                        pattern: "D D U  xU D",
                        technique: "Muted x for small breath before resolution.",
                        extra: "Aim to land on Am7 like a soft landing."
                    },
                    {
                        name: "Gentle Waltz",
                        chords: ["Cmaj7", "Fmaj7", "G", "C"],
                        pattern: "D   D   D U",
                        technique: "1-2-3 waltz: strong‚Äìsoft‚Äìsoft.",
                        extra: "Count 1-2-3, 1-2-3 and sway with the rhythm."
                    }
                ]
            }
        };

        // ---------- Audio engine ----------
        let audioCtx = null;

        function getAudioContext() {
            if (!audioCtx) {
                const AC = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AC();
            }
            if (audioCtx.state === "suspended") {
                audioCtx.resume();
            }
            return audioCtx;
        }

        function playChord(chordName, startTime, duration = 0.8) {
            const ctx = getAudioContext();
            const notes = chords[chordName] || [];
            notes.forEach(note => {
                const freq = noteFreq[note];
                if (!freq) return;

                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.type = "triangle";
                osc.frequency.value = freq;

                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.3, startTime + 0.05);
                gain.gain.linearRampToValueAtTime(0.0001, startTime + duration);

                osc.connect(gain);
                gain.connect(ctx.destination);

                osc.start(startTime);
                osc.stop(startTime + duration + 0.05);
            });
        }

        function playProgressionObject(prog) {
            const ctx = getAudioContext();
            const spacing = 0.9;
            let now = ctx.currentTime + 0.05;
            prog.chords.forEach((chordName, idx) => {
                playChord(chordName, now + idx * spacing, 0.8);
            });
        }

        // ---------- UI wiring ----------
        const emotionsContainer = document.getElementById("emotions");
        const progressionEl = document.getElementById("progression");
        const currentEmotionEl = document.getElementById("currentEmotion");
        const currentSubEl = document.getElementById("currentSub");
        const replayBtn = document.getElementById("replayBtn");
        const metaNameEl = document.getElementById("metaName");
        const metaPatternEl = document.getElementById("metaPattern");
        const metaTechniqueEl = document.getElementById("metaTechnique");
        const metaExtraEl = document.getElementById("metaExtra");

        let currentEmotionKey = null;
        let currentProgIndex = null;

        function pickRandomIndex(arr) {
            return Math.floor(Math.random() * arr.length);
        }

        function setActiveEmotion(key) {
            currentEmotionKey = key;
            const emo = emotions[key];

            // Highlight button
            document.querySelectorAll(".emotion-btn").forEach(btn => {
                btn.classList.toggle("active", btn.dataset.emotion === key);
            });

            // choose a random progression among 10
            const idx = pickRandomIndex(emo.progressions);
            currentProgIndex = idx;
            const prog = emo.progressions[idx];

            // Update main labels
            currentEmotionEl.textContent = emo.emoji + " " + emo.label + ` ¬∑ #${idx + 1}/` + emo.progressions.length;
            currentSubEl.textContent = emo.description;

            // Show chord pills
            progressionEl.innerHTML = "";
            prog.chords.forEach(chord => {
                const span = document.createElement("span");
                span.className = "chord-pill";
                span.textContent = chord;
                progressionEl.appendChild(span);
            });

            // Meta
            metaNameEl.textContent = prog.name;
            metaPatternEl.textContent = prog.pattern;
            metaTechniqueEl.textContent = prog.technique;
            metaExtraEl.textContent = prog.extra;

            // Enable replay
            replayBtn.disabled = false;
        }

        emotionsContainer.addEventListener("click", e => {
            const btn = e.target.closest(".emotion-btn");
            if (!btn) return;
            const key = btn.dataset.emotion;
            if (!key) return;

            setActiveEmotion(key);
            const emo = emotions[key];
            const prog = emo.progressions[currentProgIndex];
            playProgressionObject(prog);
        });

        replayBtn.addEventListener("click", () => {
            if (!currentEmotionKey && currentProgIndex === null) return;
            const emo = emotions[currentEmotionKey];
            if (!emo) return;
            const prog = emo.progressions[currentProgIndex];
            playProgressionObject(prog);
        });

        // ---------- PWA: service worker registration (optional) ----------
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker
                    .register("service-worker.js")
                    .catch(err => console.warn("SW registration failed", err));
            });
        }
    </script>

    <!--
    manifest.webmanifest (unchanged, if you veux le PWA offline):

    {
      "name": "Feel Strings",
      "short_name": "FeelStrings",
      "display": "standalone",
      "start_url": "./index.html",
      "background_color": "#050608",
      "theme_color": "#111111",
      "icons": []
    }

    Simple service-worker.js:

    const CACHE_NAME = "emo-chords-v2";
    const ASSETS = ["./", "./index.html"];

    self.addEventListener("install", event => {
      event.waitUntil(
        caches.open(CACHE_NAME).then(cache => cache.addAll(ASSETS))
      );
    });

    self.addEventListener("fetch", event => {
      event.respondWith(
        caches.match(event.request).then(resp => resp || fetch(event.request))
      );
    });
  -->
</body>

</html>
